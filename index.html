<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo RFID - BR3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        body { background-color: #f8f9fa; }

        /* HEADER */
        .custom-header {
            background-color: #101d42;
            padding: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1020;
        }

        .logo-img { height: 50px; width: auto; }

        /* BARRA DE PESQUISA */
        .search-container { position: relative; max-width: 500px; width: 100%; }
        
        #search-results {
            position: absolute; top: 100%; left: 0; right: 0;
            z-index: 1000; max-height: 300px; overflow-y: auto;
            display: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* ESTILOS DOS CARDS */
        .card {
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            border: none;
            transition: transform 0.2s;
        }
        
        /* Efeito ao passar o mouse nos cards da galeria */
        .catalog-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        
        .btn-primary-custom {
            background-color: #101d42; border-color: #101d42; color: white;
        }
        .btn-primary-custom:hover {
            background-color: #1b2e63; border-color: #1b2e63; color: white;
        }
    </style>
</head>
<body>

    <header class="custom-header">
        <div class="container d-flex justify-content-between align-items-center">

            <div class="d-flex align-items-center">
                <a href="index.html" style="text-decoration: none;">
                    <img src="assets/br3.png" alt="Logo BR3" class="logo-img" onerror="this.style.display='none'; document.getElementById('alt-logo').style.display='block'">
                    <h4 id="alt-logo" class="text-white m-0 fw-bold" style="display:none;">BR3 RFID</h4>
                </a>
            </div>

            <div class="search-container mx-3 d-none d-md-block"> 
                <div class="input-group">
                    <span class="input-group-text border-0 bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" id="search-input" class="form-control border-0" placeholder="Buscar PN ou Nome..." autocomplete="off">
                </div>
                <div id="search-results" class="list-group"></div>
            </div>

            <div>
                <a href="https://wa.me/554130155343" target="_blank" class="btn btn-outline-light btn-sm fw-bold">
                    <i class="bi bi-whatsapp me-1"></i> <span class="d-none d-sm-inline">Fale Conosco</span>
                </a>
            </div>
        </div>
        
        <div class="container mt-2 d-md-none">
             <div class="search-container w-100">
                <div class="input-group input-group-sm">
                    <span class="input-group-text border-0 bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" id="search-input-mobile" class="form-control border-0" placeholder="Buscar tag..." autocomplete="off">
                </div>
                <div id="search-results-mobile" class="list-group position-absolute w-100" style="z-index:1000; display:none;"></div>
            </div>
        </div>
    </header>

    <div class="container mt-4">

        <div id="loading" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 text-muted">Carregando catálogo...</p>
        </div>

        <div id="catalog-view" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h3 style="color: #101d42;"><i class="bi bi-grid-fill me-2"></i>Catálogo Completo</h3>
                    <p class="text-muted">Selecione uma tag para ver as especificações técnicas.</p>
                </div>
            </div>
            
            <div id="catalog-grid" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4 mb-5">
            </div>
        </div>

        <div id="detail-view" style="display: none;">
            
            <div class="mb-3">
                <a href="index.html" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-arrow-left"></i> Voltar para o Catálogo
                </a>
            </div>

            <div id="error" class="alert alert-danger text-center" style="display: none;"></div>

            <div id="content" class="card p-4 mx-auto mb-5" style="max-width: 700px;">
                
                <h2 id="tag-modelo" class="text-center fw-bold" style="color: #101d42;">...</h2>
                <span class="badge bg-secondary mx-auto d-block mb-3" style="width: fit-content;" id="tag-id">...</span>

                <div class="card p-3 bg-light border-0">
                    <div class="row mb-3">
                        <div class="col-6 border-end">
                            <small class="text-muted d-block">Part Number (PN)</small>
                            <strong id="tag-partnumber" style="color:#101d42">...</strong>
                        </div>
                        <div class="col-6 ps-4">
                            <small class="text-muted d-block">Tamanho</small>
                            <strong id="tag-tamanho" style="color:#101d42">...</strong>
                        </div>
                    </div>
                    <hr>
                    
                    <div class="row mb-3">
                        <div class="col-6 border-end">
                            <small class="text-muted d-block">Fabricante</small>
                            <strong id="tag-fabricante" style="color:#101d42">...</strong>
                        </div>
                        <div class="col-6 ps-4">
                            <small class="text-muted d-block">Chip (IC)</small>
                            <strong id="tag-chip" style="color:#101d42">...</strong>
                        </div>
                    </div>
                    <hr>

                    <div class="row">
                        <div class="col-12">
                            <small class="text-muted d-block">Tipo/Superfície</small>
                            <strong id="tag-tipo">...</strong>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h5 class="fw-bold" style="color: #101d42;">Descrição</h5>
                    <p id="tag-descricao" class="text-muted">...</p>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <a id="btn-datasheet" href="#" target="_blank" class="btn btn-primary-custom btn-lg">
                        <i class="bi bi-file-earmark-pdf"></i> Baixar Datasheet Oficial
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let globalDb = {};

        async function init() {
            try {
                const response = await fetch('db.json');
                globalDb = await response.json();

                const params = new URLSearchParams(window.location.search);
                const tagId = params.get('id');

                if (tagId) {
                    exibirDetalhes(tagId);
                } else {
                    renderizarCatalogo();
                }

                configurarBusca('search-input', 'search-results');
                configurarBusca('search-input-mobile', 'search-results-mobile');

            } catch (err) {
                console.error(err);
                document.getElementById('loading').innerHTML = '<div class="alert alert-danger">Erro ao carregar dados.</div>';
            }
        }

        // TELA 1: Renderiza a grade de cards (SEM FOTO, COM PN E TAMANHO)
        function renderizarCatalogo() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('detail-view').style.display = 'none';
            document.getElementById('catalog-view').style.display = 'block';

            const grid = document.getElementById('catalog-grid');
            grid.innerHTML = '';

            Object.keys(globalDb).forEach(key => {
                const tag = globalDb[key];
                
                const col = document.createElement('div');
                col.className = 'col';
                
                // Tratamento caso os campos novos ainda não existam no JSON antigo
                const pn = tag.partNumber || '-';
                const tam = tag.tamanho || '-';

                col.innerHTML = `
                    <div class="card h-100 catalog-card">
                        <div class="card-body d-flex flex-column pt-4">
                            <h5 class="card-title fw-bold" style="color: #101d42;">${tag.modelo}</h5>
                            
                            <div class="mt-3 mb-3">
                                <p class="card-text text-muted small mb-1">ID: ${key}</p>
                                <p class="card-text small mb-1"><strong>PN:</strong> ${pn}</p>
                                <p class="card-text small mb-1"><strong>Tam:</strong> ${tam}</p>
                                <p class="card-text small text-secondary">Fab: ${tag.fabricante}</p>
                            </div>

                            <a href="?id=${key}" class="btn btn-primary-custom btn-sm mt-auto w-100">
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                `;
                grid.appendChild(col);
            });
        }

        // TELA 2: Renderiza o detalhe único
        function exibirDetalhes(id) {
            const tag = globalDb[id];
            document.getElementById('loading').style.display = 'none';
            document.getElementById('catalog-view').style.display = 'none';

            if (!tag) {
                document.getElementById('detail-view').style.display = 'block';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = `Tag <strong>${id}</strong> não encontrada. <a href="index.html">Voltar</a>`;
                return;
            }

            // Preenche os dados
            document.getElementById('tag-id').innerText = id; // ID Interno (TAG-XXXX)
            document.getElementById('tag-modelo').innerText = tag.modelo;
            
            // Novos Campos
            document.getElementById('tag-partnumber').innerText = tag.partNumber || 'N/A';
            document.getElementById('tag-tamanho').innerText = tag.tamanho || 'N/A';

            document.getElementById('tag-fabricante').innerText = tag.fabricante;
            document.getElementById('tag-tipo').innerText = tag.tipo;
            document.getElementById('tag-chip').innerText = tag.chip;
            document.getElementById('tag-descricao').innerText = tag.descricao;
            
            // Link do PDF
            document.getElementById('btn-datasheet').href = tag.pdf || '#';

            document.getElementById('detail-view').style.display = 'block';
        }

        function configurarBusca(inputId, resultsId) {
            const input = document.getElementById(inputId);
            const resultsDiv = document.getElementById(resultsId);

            if(!input) return;

            input.addEventListener('keyup', (e) => {
                const termo = e.target.value.toLowerCase();
                resultsDiv.innerHTML = '';

                if (termo.length < 1) {
                    resultsDiv.style.display = 'none';
                    return;
                }

                const resultados = Object.keys(globalDb).filter(key => {
                    const tag = globalDb[key];
                    const modelo = tag.modelo.toLowerCase();
                    const id = key.toLowerCase();
                    const pn = (tag.partNumber || '').toLowerCase(); // Busca também pelo PN Comercial
                    
                    return id.includes(termo) || modelo.includes(termo) || pn.includes(termo);
                });

                if (resultados.length > 0) {
                    resultsDiv.style.display = 'block';
                    resultados.forEach(key => {
                        const tag = globalDb[key];
                        const item = document.createElement('a');
                        item.className = 'list-group-item list-group-item-action';
                        item.href = `?id=${key}`;
                        item.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 fw-bold" style="color: #101d42;">${tag.modelo}</h6>
                                <small>${key}</small>
                            </div>
                            <small class="text-muted">PN: ${tag.partNumber || '-'} | ${tag.fabricante}</small>
                        `;
                        resultsDiv.appendChild(item);
                    });
                } else {
                    resultsDiv.style.display = 'none';
                }
            });

            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !resultsDiv.contains(e.target)) {
                    resultsDiv.style.display = 'none';
                }
            });
        }

        init();
    </script>
</body>
</html>